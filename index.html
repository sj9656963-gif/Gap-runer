<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê³µ ì í”„ ê²Œì„</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            font-family: 'Arial', sans-serif;
        }

        #gameContainer {
            text-align: center;
        }

        canvas {
            border: 4px solid #fff;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            background: linear-gradient(180deg, #87CEEB 0%, #E0F6FF 100%);
        }

        #gameInfo {
            color: white;
            margin-top: 20px;
            font-size: 20px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }


        .controls {
            color: white;
            margin-top: 15px;
            font-size: 16px;
        }

        canvas {
            cursor: pointer;
            touch-action: none; /* í„°ì¹˜ ìŠ¤í¬ë¡¤ ë°©ì§€ */
        }

        #gameOver {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 40px;
            border-radius: 15px;
            display: none;
            text-align: center;
        }

        #gameOver h2 {
            font-size: 36px;
            margin-bottom: 20px;
        }

        #gameOver p {
            font-size: 24px;
            margin: 10px 0;
        }

        #restartBtn {
            margin-top: 20px;
            padding: 15px 40px;
            font-size: 20px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.3s;
        }

        #restartBtn:hover {
            background: #764ba2;
        }

        /* UI ë²„íŠ¼ë“¤ */
        .ui-buttons {
            position: fixed;
            top: 10px;
            right: 10px;
            display: flex;
            gap: 10px;
            z-index: 999;
        }

        .ui-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: none;
            background: rgba(255, 255, 255, 0.9);
            cursor: pointer;
            font-size: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
            transition: transform 0.2s;
        }

        .ui-btn:active {
            transform: scale(0.95);
        }

        /* ë¡œë”© í™”ë©´ */
        #loadingScreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }

        #loadingScreen h1 {
            color: white;
            font-size: 48px;
            margin-bottom: 30px;
        }

        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 6px solid rgba(255,255,255,0.3);
            border-top: 6px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* ì¼ì‹œì •ì§€ í™”ë©´ */
        #pauseScreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        #pauseScreen h2 {
            color: white;
            font-size: 48px;
        }

        /* íŠœí† ë¦¬ì–¼ í™”ë©´ */
        #tutorialScreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1001;
        }

        .tutorial-content {
            background: white;
            padding: 40px;
            border-radius: 20px;
            max-width: 500px;
            text-align: center;
        }

        .tutorial-content h2 {
            color: #667eea;
            margin-bottom: 20px;
        }

        .tutorial-content p {
            font-size: 18px;
            margin: 15px 0;
            line-height: 1.6;
        }

        .tutorial-content button {
            margin-top: 20px;
            padding: 15px 40px;
            font-size: 20px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
        }

        /* ìµœê³  ê¸°ë¡ í‘œì‹œ */
        #bestScore {
            color: #FFD700;
            font-size: 18px;
            margin-top: 10px;
        }

        /* ì—…ì  ì•Œë¦¼ */
        #achievementNotification {
            position: fixed;
            top: 100px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, #FFD700, #FFA500);
            color: white;
            padding: 20px 40px;
            border-radius: 15px;
            font-size: 24px;
            font-weight: bold;
            box-shadow: 0 5px 20px rgba(0,0,0,0.4);
            display: none;
            z-index: 2000;
            animation: slideDown 0.5s ease-out;
        }

        @keyframes slideDown {
            from {
                top: -100px;
                opacity: 0;
            }
            to {
                top: 100px;
                opacity: 1;
            }
        }

        /* ë°˜ì‘í˜• ë””ìì¸ */
        @media (max-width: 600px) {
            canvas {
                max-width: 100vw;
                max-height: 70vh;
            }
        }

        /* ===== ê°œë°œì ì½˜ì†” (ì¶œì‹œ ì „ ì‚­ì œ) ===== */
        #devConsole {
            position: fixed;
            top: 10px;
            left: 10px;
            background: rgba(0, 0, 0, 0.85);
            color: #00ff00;
            font-family: 'Consolas', monospace;
            font-size: 12px;
            padding: 15px;
            border-radius: 8px;
            border: 2px solid #00ff00;
            min-width: 250px;
            box-shadow: 0 4px 20px rgba(0, 255, 0, 0.3);
            z-index: 1000;
        }

        #devConsole h3 {
            margin: 0 0 10px 0;
            color: #00ff00;
            font-size: 14px;
            border-bottom: 1px solid #00ff00;
            padding-bottom: 5px;
        }

        #devConsole .stat {
            margin: 5px 0;
            display: flex;
            justify-content: space-between;
        }

        #devConsole .stat-label {
            color: #00ff00;
        }

        #devConsole .stat-value {
            color: #ffffff;
            font-weight: bold;
        }

        #devConsole .warning {
            color: #ffaa00;
            margin-top: 10px;
            font-size: 11px;
            border-top: 1px solid #00ff00;
            padding-top: 5px;
        }
        /* ===== ê°œë°œì ì½˜ì†” ë ===== */
    </style>
</head>
<body>
    <!-- ë¡œë”© í™”ë©´ -->
    <div id="loadingScreen">
        <h1>ğŸŒ» ì í”„ ê²Œì„</h1>
        <div class="loading-spinner"></div>
        <p style="color: white; margin-top: 20px;">ë¡œë”© ì¤‘...</p>
    </div>

    <!-- íŠœí† ë¦¬ì–¼ í™”ë©´ -->
    <div id="tutorialScreen">
        <div class="tutorial-content">
            <h2>ê²Œì„ ë°©ë²•</h2>
            <p>ğŸ“± <strong>í™”ë©´ì„ í„°ì¹˜</strong>í•˜ì—¬ ì í”„í•˜ì„¸ìš”!</p>
            <p>â±ï¸ ì¥ì• ë¬¼ì„ í”¼í•˜ë©° ìµœëŒ€í•œ ì˜¤ë˜ ìƒì¡´í•˜ì„¸ìš”</p>
            <p>ğŸ“ˆ ì‹œê°„ì´ ì§€ë‚ ìˆ˜ë¡ ë‚œì´ë„ê°€ ì˜¬ë¼ê°‘ë‹ˆë‹¤</p>
            <p>ğŸ† ìµœê³  ê¸°ë¡ì— ë„ì „í•˜ì„¸ìš”!</p>
            <button id="tutorialCloseBtn">ì‹œì‘í•˜ê¸°!</button>
        </div>
    </div>

    <!-- ì¼ì‹œì •ì§€ í™”ë©´ -->
    <div id="pauseScreen">
        <h2>â¸ï¸ ì¼ì‹œì •ì§€</h2>
    </div>

    <!-- ì—…ì  ì•Œë¦¼ -->
    <div id="achievementNotification"></div>

    <!-- UI ë²„íŠ¼ë“¤ -->
    <div class="ui-buttons">
        <button class="ui-btn" id="soundBtn" title="ì‚¬ìš´ë“œ">ğŸ”Š</button>
        <button class="ui-btn" id="pauseBtn" title="ì¼ì‹œì •ì§€">â¸ï¸</button>
        <button class="ui-btn" id="fullscreenBtn" title="ì „ì²´í™”ë©´">â›¶</button>
    </div>

    <!-- ===== ê°œë°œì ì½˜ì†” (ì¶œì‹œ ì „ ì‚­ì œ) ===== -->
    <div id="devConsole">
        <h3>ğŸ› ï¸ DEV CONSOLE</h3>
        <div class="stat">
            <span class="stat-label">ê²½ê³¼ ì‹œê°„:</span>
            <span class="stat-value" id="devTime">0.000s</span>
        </div>
        <div class="stat">
            <span class="stat-label">í˜„ì¬ ì†ë„:</span>
            <span class="stat-value" id="devSpeed">0.00</span>
        </div>
        <div class="stat">
            <span class="stat-label">ì†ë„ ë°°ìœ¨:</span>
            <span class="stat-value" id="devSpeedMult">1.00x</span>
        </div>
        <div class="stat">
            <span class="stat-label">ì¥ì• ë¬¼ ê°„ê²©:</span>
            <span class="stat-value" id="devGap">280px</span>
        </div>
        <div class="stat">
            <span class="stat-label">ìƒì„± ì£¼ê¸°:</span>
            <span class="stat-value" id="devSpawn">120f</span>
        </div>
        <div class="stat">
            <span class="stat-label">ì¥ì• ë¬¼ ìˆ˜:</span>
            <span class="stat-value" id="devObstacles">0</span>
        </div>
        <div class="stat">
            <span class="stat-label">FPS:</span>
            <span class="stat-value" id="devFPS">60</span>
        </div>
        <div class="stat">
            <span class="stat-label">ë¬´ì  ëª¨ë“œ:</span>
            <span class="stat-value" id="devGodMode" style="color: #ff0000;">OFF</span>
        </div>
        <div class="warning">
            âš ï¸ ì¶œì‹œ ì „ ì‚­ì œ í•„ìš”<br>
            [G] ë¬´ì  ëª¨ë“œ ON/OFF<br>
            [T] ì‹œê°„ +20ì´ˆ ê±´ë„ˆë›°ê¸°
        </div>
    </div>
    <!-- ===== ê°œë°œì ì½˜ì†” ë ===== -->

    <div id="gameContainer">
        <canvas id="gameCanvas" width="400" height="600"></canvas>
        <div id="gameInfo">
            <div id="difficulty">ë‚œì´ë„: 1ë‹¨ê³„</div>
            <div id="timer">ì‹œê°„: 0ì´ˆ</div>
            <div id="bestScore">ìµœê³  ê¸°ë¡: 0.000ì´ˆ</div>
        </div>
        <div class="controls">
            í„°ì¹˜ë¡œ ì í”„!
        </div>
        <div id="gameOver">
            <h2>ê²Œì„ ì˜¤ë²„!</h2>
            <p id="finalTime"></p>
            <p id="newRecord" style="color: #FFD700; display: none;">ğŸ‰ ì‹ ê¸°ë¡!</p>
            <p id="achievementSummary"></p>
            <button id="restartBtn">ë‹¤ì‹œ ì‹œì‘</button>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        // ì˜¤ë””ì˜¤ ì„¤ì • (Web Audio API ì‚¬ìš©)
        const AudioContext = window.AudioContext || window.webkitAudioContext;
        const audioContext = new AudioContext();
        let bgmGainNode = null;
        let bgmSource = null;
        let isMusicPlaying = false;

        // ë°°ê²½ìŒì•… ìƒì„± (ë°ê³  ê²½ì¾Œí•œ ë©œë¡œë””)
        function createBackgroundMusic() {
            if (isMusicPlaying) return;

            // ì˜¤ë””ì˜¤ ì»¨í…ìŠ¤íŠ¸ ì¬ê°œ
            audioContext.resume();

            isMusicPlaying = true;
            bgmGainNode = audioContext.createGain();
            bgmGainNode.gain.value = 0.08;
            bgmGainNode.connect(audioContext.destination);

            // ë” ë°ê³  ê²½ì¾Œí•œ ë©œë¡œë””: C-E-G-C-G-E-C-D-E
            const melody = [
                523.25, 659.25, 783.99, 1046.50, 783.99, 659.25, 523.25, 587.33,
                659.25, 783.99, 659.25, 523.25, 587.33, 659.25, 523.25, 659.25
            ];

            // ë² ì´ìŠ¤ ë¼ì¸ (ì˜¥íƒ€ë¸Œ ì•„ë˜)
            const bassLine = [
                261.63, 329.63, 392.00, 523.25, 392.00, 329.63, 261.63, 293.66,
                329.63, 392.00, 329.63, 261.63, 293.66, 329.63, 261.63, 329.63
            ];

            let noteIndex = 0;

            function playNote() {
                if (!isMusicPlaying) return;

                // ë©œë¡œë”” íŒŒíŠ¸
                const osc1 = audioContext.createOscillator();
                osc1.type = 'triangle';
                osc1.frequency.value = melody[noteIndex];

                const gain1 = audioContext.createGain();
                gain1.gain.setValueAtTime(0.04, audioContext.currentTime);
                gain1.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 0.35);

                osc1.connect(gain1);
                gain1.connect(bgmGainNode);

                osc1.start(audioContext.currentTime);
                osc1.stop(audioContext.currentTime + 0.35);

                // ë² ì´ìŠ¤ íŒŒíŠ¸
                const osc2 = audioContext.createOscillator();
                osc2.type = 'sine';
                osc2.frequency.value = bassLine[noteIndex];

                const gain2 = audioContext.createGain();
                gain2.gain.setValueAtTime(0.02, audioContext.currentTime);
                gain2.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 0.35);

                osc2.connect(gain2);
                gain2.connect(bgmGainNode);

                osc2.start(audioContext.currentTime);
                osc2.stop(audioContext.currentTime + 0.35);

                noteIndex = (noteIndex + 1) % melody.length;
                setTimeout(playNote, 350);
            }

            playNote();
        }

        // ì£½ìŒ íš¨ê³¼ìŒ
        function playDeathSound() {
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();

            oscillator.type = 'sawtooth';
            oscillator.frequency.setValueAtTime(400, audioContext.currentTime);
            oscillator.frequency.exponentialRampToValueAtTime(50, audioContext.currentTime + 0.5);

            gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);

            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);

            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.5);
        }

        // ì í”„ íš¨ê³¼ìŒ
        function playJumpSound() {
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();

            oscillator.type = 'sine';
            oscillator.frequency.setValueAtTime(600, audioContext.currentTime);
            oscillator.frequency.exponentialRampToValueAtTime(300, audioContext.currentTime + 0.1);

            gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);

            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);

            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.1);
        }

        // ê²Œì„ ë³€ìˆ˜
        let gameTime = 0;
        let isGameOver = false;
        let gameStarted = false;
        let isPaused = false;
        let startTime = Date.now();
        let lastFrameTime = Date.now();
        let pauseStartTime = 0;
        let totalPauseTime = 0;

        // ì‚¬ìš´ë“œ ì„¤ì •
        let soundEnabled = true;

        // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ê´€ë¦¬
        const STORAGE_KEY = 'jumpGameData';
        let bestScore = 0;
        let unlockedAchievements = [];

        // ì—…ì  ì •ì˜
        const achievements = [
            { id: 'survivor_10', name: 'ìƒì¡´ì', description: '10ì´ˆ ìƒì¡´', time: 10, unlocked: false },
            { id: 'survivor_30', name: 'ë„ì „ì', description: '30ì´ˆ ìƒì¡´', time: 30, unlocked: false },
            { id: 'survivor_60', name: 'ì „ë¬¸ê°€', description: '60ì´ˆ ìƒì¡´', time: 60, unlocked: false },
            { id: 'survivor_90', name: 'ë§ˆìŠ¤í„°', description: '90ì´ˆ ìƒì¡´', time: 90, unlocked: false },
            { id: 'survivor_120', name: 'ì „ì„¤', description: '120ì´ˆ ìƒì¡´', time: 120, unlocked: false }
        ];

        // íŒŒí‹°í´ ë°°ì—´
        let particles = [];

        // ===== ê°œë°œì ì½˜ì†” ë³€ìˆ˜ (ì¶œì‹œ ì „ ì‚­ì œ) =====
        let fpsCounter = 0;
        let fpsLastTime = Date.now();
        let currentFPS = 60;
        let godMode = false; // ë¬´ì  ëª¨ë“œ
        // ===== ê°œë°œì ì½˜ì†” ë³€ìˆ˜ ë =====

        // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ë¡œë“œ
        function loadGameData() {
            const data = localStorage.getItem(STORAGE_KEY);
            if (data) {
                const parsed = JSON.parse(data);
                bestScore = parsed.bestScore || 0;
                unlockedAchievements = parsed.achievements || [];

                // ì—…ì  ë³µì›
                achievements.forEach(ach => {
                    if (unlockedAchievements.includes(ach.id)) {
                        ach.unlocked = true;
                    }
                });
            }
            updateBestScoreDisplay();
        }

        // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ì €ì¥
        function saveGameData() {
            const data = {
                bestScore: bestScore,
                achievements: unlockedAchievements
            };
            localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
        }

        // ìµœê³  ê¸°ë¡ í‘œì‹œ ì—…ë°ì´íŠ¸
        function updateBestScoreDisplay() {
            document.getElementById('bestScore').textContent = `ìµœê³  ê¸°ë¡: ${bestScore.toFixed(3)}ì´ˆ`;
        }

        // íŒŒí‹°í´ í´ë˜ìŠ¤
        class Particle {
            constructor(x, y, color, velocityX, velocityY) {
                this.x = x;
                this.y = y;
                this.color = color;
                this.velocityX = velocityX;
                this.velocityY = velocityY;
                this.alpha = 1;
                this.radius = Math.random() * 3 + 2;
            }

            update() {
                this.x += this.velocityX;
                this.y += this.velocityY;
                this.velocityY += 0.2; // ì¤‘ë ¥
                this.alpha -= 0.02;
            }

            draw() {
                ctx.save();
                ctx.globalAlpha = this.alpha;
                ctx.fillStyle = this.color;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                ctx.fill();
                ctx.restore();
            }

            isDead() {
                return this.alpha <= 0;
            }
        }

        // íŒŒí‹°í´ ìƒì„±
        function createParticles(x, y, color, count = 10) {
            for (let i = 0; i < count; i++) {
                const angle = (Math.PI * 2 * i) / count;
                const speed = Math.random() * 3 + 2;
                const velocityX = Math.cos(angle) * speed;
                const velocityY = Math.sin(angle) * speed - 2;
                particles.push(new Particle(x, y, color, velocityX, velocityY));
            }
        }

        // íŒŒí‹°í´ ì—…ë°ì´íŠ¸ ë° ê·¸ë¦¬ê¸°
        function updateAndDrawParticles() {
            particles = particles.filter(p => !p.isDead());
            particles.forEach(p => {
                p.update();
                p.draw();
            });
        }

        // ì—…ì  í™•ì¸
        function checkAchievements(time) {
            achievements.forEach(ach => {
                if (!ach.unlocked && time >= ach.time) {
                    ach.unlocked = true;
                    unlockedAchievements.push(ach.id);
                    showAchievementNotification(ach);
                    saveGameData();
                }
            });
        }

        // ì—…ì  ì•Œë¦¼ í‘œì‹œ
        function showAchievementNotification(achievement) {
            const notif = document.getElementById('achievementNotification');
            notif.textContent = `ğŸ† ${achievement.name} ë‹¬ì„±!`;
            notif.style.display = 'block';

            setTimeout(() => {
                notif.style.display = 'none';
            }, 3000);
        }

        // ì§„ë™ í”¼ë“œë°± (ëª¨ë°”ì¼)
        function vibrate(duration = 50) {
            if (navigator.vibrate) {
                navigator.vibrate(duration);
            }
        }

        // ìºë¦­í„° ì´ë¯¸ì§€ ë¡œë“œ
        const characterImg = new Image();
        characterImg.src = 'character.png';
        let imageLoaded = false;
        characterImg.onload = function() {
            imageLoaded = true;
            // ë¡œë”© ì™„ë£Œ í›„ ë¡œë”© í™”ë©´ ìˆ¨ê¸°ê¸°
            setTimeout(() => {
                document.getElementById('loadingScreen').style.display = 'none';
                // ì²« ì‹¤í–‰ ì‹œ íŠœí† ë¦¬ì–¼ í‘œì‹œ
                if (!localStorage.getItem(STORAGE_KEY)) {
                    document.getElementById('tutorialScreen').style.display = 'flex';
                }
            }, 1000);
        };

        // ê³µ ì„¤ì •
        const ball = {
            x: 200,
            y: 100,
            radius: 15,
            velocityY: 0,
            gravity: 0.35,
            jumpPower: -9,
            canJump: true
        };

        // ì¥ì• ë¬¼ ë°°ì—´
        let obstacles = [];
        let obstacleSpeed = 2;
        let obstacleSpawnRate = 120; // í”„ë ˆì„ ë‹¨ìœ„
        let frameCount = 0;

        // ë‚œì´ë„ ì„¤ì •
        let difficultyLevel = 1;
        const maxDifficulty = 15;

        // ì¥ì• ë¬¼ ìƒì„±
        function createObstacle() {
            const elapsedTime = gameStarted ? (Date.now() - startTime) / 1000 : 0;

            // ì‹œê°„ì— ë”°ë¼ ê°„ê²©ì´ ì ì  ì¢ì•„ì§ (ìµœì†Œ 85pxê¹Œì§€ ê°ì†Œ - 150ì´ˆì— ë„ë‹¬)
            const maxGap = 280;
            const minGap = 85;
            const gapReduction = Math.min(elapsedTime * 1.3, maxGap - minGap); // 1ì´ˆë‹¹ 1.3px ê°ì†Œ
            const gap = Math.max(minGap, maxGap - gapReduction);

            const gapPosition = Math.random() * (canvas.height - gap - 100) + 50;

            obstacles.push({
                x: canvas.width,
                topHeight: gapPosition,
                bottomY: gapPosition + gap,
                width: 50,
                passed: false
            });
        }

        // ë‚œì´ë„ ì—…ë°ì´íŠ¸
        function updateDifficulty() {
            const elapsedTime = gameStarted ? (Date.now() - startTime) / 1000 : 0;

            // ì‹œê°„ì— ë”°ë¼ ì†ë„ê°€ ì ì  ë¹¨ë¼ì§ (ì´ˆë°˜ ì†ë„ 2, ìµœëŒ€ 5.5ë°°ê¹Œì§€ - 150ì´ˆì— ë„ë‹¬)
            const speedMultiplier = Math.min(1 + (elapsedTime * 0.03), 5.5); // 1ì´ˆë‹¹ 3% ì¦ê°€, ìµœëŒ€ 5.5ë°°
            obstacleSpeed = 2 * speedMultiplier;

            // ì¥ì• ë¬¼ ìƒì„± ê°„ê²©ë„ ì ì  ì§§ì•„ì§ (ìµœì†Œ 25í”„ë ˆì„ê¹Œì§€ - 150ì´ˆì— ë„ë‹¬)
            const spawnReduction = Math.min(elapsedTime * 0.633, 95);
            obstacleSpawnRate = Math.max(25, 120 - spawnReduction);

            // ë‚œì´ë„ ë ˆë²¨ í‘œì‹œ (10ì´ˆë§ˆë‹¤ 1ë‹¨ê³„ì”© ì¦ê°€)
            const newLevel = Math.min(Math.floor(elapsedTime / 10) + 1, maxDifficulty);
            if (newLevel !== difficultyLevel) {
                difficultyLevel = newLevel;
                document.getElementById('difficulty').textContent = `ë‚œì´ë„: ${difficultyLevel}ë‹¨ê³„`;
            }
        }

        // ìºë¦­í„° ì´ë¯¸ì§€ ê·¸ë¦¬ê¸°
        function drawBall() {
            const centerX = ball.x;
            const centerY = ball.y;
            const size = ball.radius * 2; // ì´ë¯¸ì§€ í¬ê¸° (ì§ê²½)

            // ===== ê°œë°œì ì½˜ì†”: ë¬´ì  ëª¨ë“œ ì‹œê° íš¨ê³¼ (ì¶œì‹œ ì „ ì‚­ì œ) =====
            if (godMode) {
                const hue = (Date.now() / 10) % 360;
                ctx.shadowBlur = 20;
                ctx.shadowColor = `hsl(${hue}, 100%, 50%)`;
            }
            // ===== ê°œë°œì ì½˜ì†”: ë¬´ì  ëª¨ë“œ ì‹œê° íš¨ê³¼ ë =====

            // ì´ë¯¸ì§€ê°€ ë¡œë“œë˜ì—ˆìœ¼ë©´ ì´ë¯¸ì§€ ê·¸ë¦¬ê¸°, ì•„ë‹ˆë©´ ê¸°ë³¸ ì› ê·¸ë¦¬ê¸°
            if (imageLoaded) {
                ctx.save();

                // ë¬´ì  ëª¨ë“œì¼ ë•Œ ìƒ‰ìƒ í•„í„° ì ìš©
                if (godMode) {
                    const hue = (Date.now() / 10) % 360;
                    ctx.filter = `hue-rotate(${hue}deg) brightness(1.2)`;
                }

                // ì´ë¯¸ì§€ë¥¼ ì¤‘ì‹¬ì  ê¸°ì¤€ìœ¼ë¡œ ê·¸ë¦¬ê¸°
                ctx.drawImage(
                    characterImg,
                    centerX - size,
                    centerY - size,
                    size * 2,
                    size * 2
                );

                ctx.restore();
            } else {
                // ì´ë¯¸ì§€ ë¡œë”© ì¤‘ì¼ ë•ŒëŠ” ê¸°ë³¸ ì› í‘œì‹œ
                ctx.beginPath();
                ctx.arc(centerX, centerY, ball.radius, 0, Math.PI * 2);
                ctx.fillStyle = godMode ? `hsl(${(Date.now() / 10) % 360}, 100%, 50%)` : '#FFD54F';
                ctx.fill();
                ctx.strokeStyle = '#5D4037';
                ctx.lineWidth = 2;
                ctx.stroke();
            }

            // ===== ê°œë°œì ì½˜ì†”: ë¬´ì  ëª¨ë“œ ì„€ë„ìš° ë¦¬ì…‹ (ì¶œì‹œ ì „ ì‚­ì œ) =====
            if (godMode) {
                ctx.shadowBlur = 0;
            }
            // ===== ê°œë°œì ì½˜ì†”: ë¬´ì  ëª¨ë“œ ì„€ë„ìš° ë¦¬ì…‹ ë =====
        }

        // ì¥ì• ë¬¼ ê·¸ë¦¬ê¸°
        function drawObstacles() {
            obstacles.forEach(obstacle => {
                // ìœ„ìª½ ì¥ì• ë¬¼
                const gradient1 = ctx.createLinearGradient(obstacle.x, 0, obstacle.x + obstacle.width, 0);
                gradient1.addColorStop(0, '#2E7D32');
                gradient1.addColorStop(1, '#4CAF50');

                ctx.fillStyle = gradient1;
                ctx.fillRect(obstacle.x, 0, obstacle.width, obstacle.topHeight);
                ctx.strokeStyle = '#1B5E20';
                ctx.lineWidth = 2;
                ctx.strokeRect(obstacle.x, 0, obstacle.width, obstacle.topHeight);

                // ì•„ë˜ìª½ ì¥ì• ë¬¼
                const gradient2 = ctx.createLinearGradient(obstacle.x, obstacle.bottomY, obstacle.x + obstacle.width, canvas.height);
                gradient2.addColorStop(0, '#2E7D32');
                gradient2.addColorStop(1, '#4CAF50');

                ctx.fillStyle = gradient2;
                ctx.fillRect(obstacle.x, obstacle.bottomY, obstacle.width, canvas.height - obstacle.bottomY);
                ctx.strokeStyle = '#1B5E20';
                ctx.lineWidth = 2;
                ctx.strokeRect(obstacle.x, obstacle.bottomY, obstacle.width, canvas.height - obstacle.bottomY);
            });
        }

        // ì¶©ëŒ ê°ì§€
        function checkCollision() {
            // ===== ê°œë°œì ì½˜ì†”: ë¬´ì  ëª¨ë“œ (ì¶œì‹œ ì „ ì‚­ì œ) =====
            if (godMode) return; // ë¬´ì  ëª¨ë“œì¼ ë•ŒëŠ” ì¶©ëŒ ë¬´ì‹œ
            // ===== ê°œë°œì ì½˜ì†”: ë¬´ì  ëª¨ë“œ ë =====

            // ë°”ë‹¥ê³¼ ì²œì¥ ì¶©ëŒ
            if (ball.y + ball.radius > canvas.height || ball.y - ball.radius < 0) {
                endGame();
                return;
            }

            // ì¥ì• ë¬¼ ì¶©ëŒ
            obstacles.forEach(obstacle => {
                if (ball.x + ball.radius > obstacle.x &&
                    ball.x - ball.radius < obstacle.x + obstacle.width) {

                    if (ball.y - ball.radius < obstacle.topHeight ||
                        ball.y + ball.radius > obstacle.bottomY) {
                        endGame();
                    }
                }
            });
        }

        // ê³µ ì—…ë°ì´íŠ¸
        function updateBall() {
            if (gameStarted) {
                ball.velocityY += ball.gravity;
                ball.y += ball.velocityY;
            }
        }

        // ì¥ì• ë¬¼ ì—…ë°ì´íŠ¸
        function updateObstacles() {
            if (!gameStarted) return;

            obstacles.forEach((obstacle, index) => {
                obstacle.x -= obstacleSpeed;

                // í™”ë©´ ë°–ìœ¼ë¡œ ë‚˜ê°„ ì¥ì• ë¬¼ ì œê±°
                if (obstacle.x + obstacle.width < 0) {
                    obstacles.splice(index, 1);
                }
            });

            // ìƒˆ ì¥ì• ë¬¼ ìƒì„±
            frameCount++;
            if (frameCount > obstacleSpawnRate) {
                createObstacle();
                frameCount = 0;
            }
        }

        // ê²Œì„ ì‹œì‘
        function startGame() {
            if (!gameStarted && !isGameOver) {
                gameStarted = true;
                startTime = Date.now();
                createBackgroundMusic(); // ë°°ê²½ìŒì•… ì‹œì‘
            }
        }

        // ì í”„
        function jump() {
            if (!gameStarted) {
                startGame();
                return; // ê²Œì„ ì‹œì‘ ì‹œì—ëŠ” ì í”„í•˜ì§€ ì•ŠìŒ
            }
            if (isPaused) return; // ì¼ì‹œì •ì§€ ì¤‘ì—ëŠ” ì í”„ ë¶ˆê°€
            if (ball.canJump && !isGameOver && gameStarted) {
                ball.velocityY = ball.jumpPower;
                ball.canJump = false;
                if (soundEnabled) playJumpSound(); // ì í”„ íš¨ê³¼ìŒ
                createParticles(ball.x, ball.y, '#FFD54F', 8); // ì í”„ íŒŒí‹°í´
                vibrate(30); // ì§„ë™ í”¼ë“œë°±
            }
        }

        // ê²Œì„ ì¢…ë£Œ
        function endGame() {
            if (isGameOver) return;

            isGameOver = true;
            isMusicPlaying = false; // ë°°ê²½ìŒì•… ì¤‘ì§€
            if (soundEnabled) playDeathSound(); // ì£½ìŒ íš¨ê³¼ìŒ

            const finalTime = parseFloat(((Date.now() - startTime - totalPauseTime) / 1000).toFixed(3));
            document.getElementById('finalTime').textContent = `ê¸°ë¡: ${finalTime.toFixed(3)}ì´ˆ`;

            // ì¶©ëŒ íŒŒí‹°í´
            createParticles(ball.x, ball.y, '#FF6B6B', 20);
            vibrate(200); // ê°•í•œ ì§„ë™

            // ì‹ ê¸°ë¡ í™•ì¸
            const newRecord = document.getElementById('newRecord');
            if (finalTime > bestScore) {
                bestScore = finalTime;
                saveGameData();
                updateBestScoreDisplay();
                newRecord.style.display = 'block';
            } else {
                newRecord.style.display = 'none';
            }

            // ì—…ì  ìš”ì•½
            const unlockedCount = achievements.filter(a => a.unlocked).length;
            document.getElementById('achievementSummary').textContent =
                `ì—…ì : ${unlockedCount}/${achievements.length} ë‹¬ì„±`;

            document.getElementById('gameOver').style.display = 'block';
        }

        // ê²Œì„ ë¦¬ì…‹
        function resetGame() {
            ball.x = 200;
            ball.y = 100;
            ball.velocityY = 0;
            ball.canJump = true;

            gameTime = 0;
            isGameOver = false;
            gameStarted = false;
            isPaused = false;
            obstacles = [];
            particles = [];
            frameCount = 0;
            difficultyLevel = 1;
            obstacleSpeed = 2;
            obstacleSpawnRate = 120;
            totalPauseTime = 0;

            startTime = Date.now();

            document.getElementById('difficulty').textContent = 'ë‚œì´ë„: 1ë‹¨ê³„';
            document.getElementById('timer').textContent = 'ì‹œê°„: 0ì´ˆ';
            document.getElementById('gameOver').style.display = 'none';
            document.getElementById('pauseScreen').style.display = 'none';

            gameLoop();
        }

        // ===== ê°œë°œì ì½˜ì†” ì—…ë°ì´íŠ¸ í•¨ìˆ˜ (ì¶œì‹œ ì „ ì‚­ì œ) =====
        function updateDevConsole() {
            const elapsedTime = gameStarted ? (Date.now() - startTime) / 1000 : 0;

            // í˜„ì¬ ê°„ê²© ê³„ì‚°
            const maxGap = 280;
            const minGap = 85;
            const gapReduction = Math.min(elapsedTime * 1.3, maxGap - minGap);
            const currentGap = Math.max(minGap, maxGap - gapReduction);

            // ì†ë„ ë°°ìœ¨ ê³„ì‚°
            const speedMultiplier = Math.min(1 + (elapsedTime * 0.03), 5.5);

            // FPS ê³„ì‚°
            fpsCounter++;
            const now = Date.now();
            if (now - fpsLastTime >= 1000) {
                currentFPS = fpsCounter;
                fpsCounter = 0;
                fpsLastTime = now;
            }

            // ê°œë°œì ì½˜ì†” ì—…ë°ì´íŠ¸
            document.getElementById('devTime').textContent = elapsedTime.toFixed(3) + 's';
            document.getElementById('devSpeed').textContent = obstacleSpeed.toFixed(2);
            document.getElementById('devSpeedMult').textContent = speedMultiplier.toFixed(2) + 'x';
            document.getElementById('devGap').textContent = Math.round(currentGap) + 'px';
            document.getElementById('devSpawn').textContent = Math.round(obstacleSpawnRate) + 'f';
            document.getElementById('devObstacles').textContent = obstacles.length;
            document.getElementById('devFPS').textContent = currentFPS;

            // ë¬´ì  ëª¨ë“œ í‘œì‹œ
            const godModeEl = document.getElementById('devGodMode');
            if (godMode) {
                godModeEl.textContent = 'ON';
                godModeEl.style.color = '#00ff00';
            } else {
                godModeEl.textContent = 'OFF';
                godModeEl.style.color = '#ff0000';
            }
        }
        // ===== ê°œë°œì ì½˜ì†” ì—…ë°ì´íŠ¸ í•¨ìˆ˜ ë =====

        // ê²Œì„ ë£¨í”„
        function gameLoop() {
            if (isGameOver) return;
            if (isPaused) {
                requestAnimationFrame(gameLoop);
                return;
            }

            // ===== ê°œë°œì ì½˜ì†” ì—…ë°ì´íŠ¸ (ì¶œì‹œ ì „ ì‚­ì œ) =====
            updateDevConsole();
            // ===== ê°œë°œì ì½˜ì†” ì—…ë°ì´íŠ¸ ë =====

            // ìº”ë²„ìŠ¤ í´ë¦¬ì–´
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // ë‚œì´ë„ë³„ ë°°ê²½ ìƒ‰ìƒ ë³€í™”
            const elapsedTime = gameStarted ? (Date.now() - startTime - totalPauseTime) / 1000 : 0;
            let bgColor1, bgColor2;

            if (difficultyLevel <= 5) {
                bgColor1 = '#87CEEB'; // í•˜ëŠ˜ìƒ‰
                bgColor2 = '#E0F6FF';
            } else if (difficultyLevel <= 10) {
                bgColor1 = '#FFA07A'; // ì£¼í™©ìƒ‰
                bgColor2 = '#FFE4B5';
            } else {
                bgColor1 = '#FF6B6B'; // ë¹¨ê°„ìƒ‰
                bgColor2 = '#FFB4B4';
            }

            // ë°°ê²½ ê·¸ë¼ë””ì–¸íŠ¸
            const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
            gradient.addColorStop(0, bgColor1);
            gradient.addColorStop(1, bgColor2);
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // êµ¬ë¦„ íš¨ê³¼
            ctx.fillStyle = 'rgba(255, 255, 255, 0.3)';
            ctx.beginPath();
            ctx.arc(100, 100, 40, 0, Math.PI * 2);
            ctx.arc(130, 95, 50, 0, Math.PI * 2);
            ctx.arc(160, 100, 40, 0, Math.PI * 2);
            ctx.fill();

            // ê²Œì„ ì‹œì‘ ì „ ì•ˆë‚´ ë©”ì‹œì§€
            if (!gameStarted) {
                ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
                ctx.fillRect(50, 250, 300, 100);
                ctx.fillStyle = '#FFFFFF';
                ctx.font = 'bold 24px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('í„°ì¹˜í•˜ì—¬', 200, 285);
                ctx.fillText('ê²Œì„ì„ ì‹œì‘í•˜ì„¸ìš”!', 200, 320);
                ctx.textAlign = 'left';
            }

            // ê²Œì„ ì‹œê°„ ì—…ë°ì´íŠ¸
            if (gameStarted) {
                const elapsedTime = (Date.now() - startTime - totalPauseTime) / 1000;
                const displayTime = elapsedTime.toFixed(3);
                const currentTime = Math.floor(elapsedTime);

                // ë§¤ í”„ë ˆì„ë§ˆë‹¤ ë‚œì´ë„ ì—…ë°ì´íŠ¸ (ì†ë„ì™€ ê°„ê²©ì´ ì‹¤ì‹œê°„ìœ¼ë¡œ ë³€í•¨)
                updateDifficulty();

                // ì—…ì  í™•ì¸
                checkAchievements(elapsedTime);

                if (currentTime !== gameTime) {
                    gameTime = currentTime;
                    document.getElementById('timer').textContent = `ì‹œê°„: ${displayTime}ì´ˆ`;
                }

                // ìš°ì¸¡ ìƒë‹¨ì— ì‹œê°„ í‘œì‹œ
                const timeStr = elapsedTime.toFixed(3);

                // ë°°ê²½ ë°•ìŠ¤
                ctx.fillStyle = 'rgba(0, 0, 0, 0.75)';
                ctx.shadowColor = 'rgba(0, 0, 0, 0.5)';
                ctx.shadowBlur = 10;
                ctx.shadowOffsetX = 0;
                ctx.shadowOffsetY = 4;
                ctx.fillRect(canvas.width - 160, 15, 145, 55);
                ctx.shadowBlur = 0;
                ctx.shadowOffsetX = 0;
                ctx.shadowOffsetY = 0;

                // í…Œë‘ë¦¬
                ctx.strokeStyle = '#FFD700';
                ctx.lineWidth = 2;
                ctx.strokeRect(canvas.width - 160, 15, 145, 55);

                // íƒ€ì´í‹€
                ctx.fillStyle = '#FFD700';
                ctx.font = 'bold 14px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('TIME', canvas.width - 87.5, 35);

                // ì‹œê°„ í‘œì‹œ
                ctx.fillStyle = '#FFFFFF';
                ctx.font = 'bold 22px Consolas, monospace';
                ctx.textAlign = 'center';
                ctx.fillText(timeStr + 's', canvas.width - 87.5, 60);

                ctx.textAlign = 'left';
            }

            // ì—…ë°ì´íŠ¸
            updateBall();
            updateObstacles();

            // ê·¸ë¦¬ê¸°
            drawObstacles();
            drawBall();
            updateAndDrawParticles(); // íŒŒí‹°í´ ê·¸ë¦¬ê¸°

            // ì¶©ëŒ ê°ì§€
            checkCollision();

            requestAnimationFrame(gameLoop);
        }

        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ - í„°ì¹˜ ë° í´ë¦­
        function handleJump() {
            jump();
            setTimeout(() => {
                ball.canJump = true;
            }, 100);
        }

        // í„°ì¹˜ ì´ë²¤íŠ¸ (ëª¨ë°”ì¼)
        canvas.addEventListener('touchstart', (e) => {
            e.preventDefault(); // ê¸°ë³¸ í„°ì¹˜ ë™ì‘ ë°©ì§€
            handleJump();
        });

        // í´ë¦­ ì´ë²¤íŠ¸ (PC)
        canvas.addEventListener('click', () => {
            handleJump();
        });

        // ===== ê°œë°œì ì½˜ì†”: í‚¤ë³´ë“œ ì¹˜íŠ¸í‚¤ (ì¶œì‹œ ì „ ì‚­ì œ) =====
        document.addEventListener('keydown', (e) => {
            // ìŠ¤í˜ì´ìŠ¤ë°”ë¡œë„ ì í”„ ê°€ëŠ¥ (ê°œë°œ í¸ì˜ìš©)
            if (e.code === 'Space') {
                e.preventDefault();
                handleJump();
            }

            // ë¬´ì  ëª¨ë“œ
            if (e.code === 'KeyG') {
                godMode = !godMode;
                console.log('ë¬´ì  ëª¨ë“œ:', godMode ? 'ON' : 'OFF');
            }

            // ì‹œê°„ ê±´ë„ˆë›°ê¸°
            if (e.code === 'KeyT' && gameStarted) {
                startTime -= 20000; // 20ì´ˆ = 20000ms
                const newElapsedTime = (Date.now() - startTime) / 1000;
                console.log('ì‹œê°„ ì í”„: +20ì´ˆ (í˜„ì¬:', newElapsedTime.toFixed(3) + 's)');
            }
        });
        // ===== ê°œë°œì ì½˜ì†”: í‚¤ë³´ë“œ ì¹˜íŠ¸í‚¤ ë =====

        document.getElementById('restartBtn').addEventListener('click', resetGame);

        // UI ë²„íŠ¼ ì´ë²¤íŠ¸
        // ì‚¬ìš´ë“œ í† ê¸€
        document.getElementById('soundBtn').addEventListener('click', () => {
            soundEnabled = !soundEnabled;
            document.getElementById('soundBtn').textContent = soundEnabled ? 'ğŸ”Š' : 'ğŸ”‡';
            if (!soundEnabled) {
                isMusicPlaying = false;
            } else if (gameStarted && !isGameOver) {
                createBackgroundMusic();
            }
        });

        // ì¼ì‹œì •ì§€
        document.getElementById('pauseBtn').addEventListener('click', () => {
            if (isGameOver || !gameStarted) return;

            isPaused = !isPaused;
            document.getElementById('pauseBtn').textContent = isPaused ? 'â–¶ï¸' : 'â¸ï¸';
            document.getElementById('pauseScreen').style.display = isPaused ? 'flex' : 'none';

            if (isPaused) {
                pauseStartTime = Date.now();
                isMusicPlaying = false;
            } else {
                totalPauseTime += Date.now() - pauseStartTime;
                if (soundEnabled) {
                    createBackgroundMusic();
                }
            }
        });

        // ì „ì²´í™”ë©´
        document.getElementById('fullscreenBtn').addEventListener('click', () => {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen().catch(err => {
                    console.log('ì „ì²´í™”ë©´ ì‹¤íŒ¨:', err);
                });
            } else {
                document.exitFullscreen();
            }
        });

        // íŠœí† ë¦¬ì–¼ ë‹«ê¸°
        document.getElementById('tutorialCloseBtn').addEventListener('click', () => {
            document.getElementById('tutorialScreen').style.display = 'none';
        });

        // í™”ë©´ ë¦¬ì‚¬ì´ì¦ˆ ë° ë°©í–¥ ì „í™˜ ì²˜ë¦¬
        function resizeCanvas() {
            const container = document.getElementById('gameContainer');
            const maxWidth = window.innerWidth - 40;
            const maxHeight = window.innerHeight - 200;

            let newWidth = 400;
            let newHeight = 600;

            // ì„¸ë¡œ ëª¨ë“œ (ëª¨ë°”ì¼)
            if (window.innerWidth < window.innerHeight) {
                newWidth = Math.min(maxWidth, 400);
                newHeight = newWidth * 1.5;
            }
            // ê°€ë¡œ ëª¨ë“œ (ëª¨ë°”ì¼ ë˜ëŠ” íƒœë¸”ë¦¿)
            else if (window.innerWidth < 800) {
                newHeight = Math.min(maxHeight, 400);
                newWidth = newHeight * 0.667;
            }

            // ìº”ë²„ìŠ¤ í¬ê¸°ëŠ” ìœ ì§€í•˜ê³  CSSë¡œ ìŠ¤ì¼€ì¼ë§
            const scaleX = newWidth / 400;
            const scaleY = newHeight / 600;
            const scale = Math.min(scaleX, scaleY);

            canvas.style.width = (400 * scale) + 'px';
            canvas.style.height = (600 * scale) + 'px';
        }

        window.addEventListener('resize', resizeCanvas);
        window.addEventListener('orientationchange', () => {
            setTimeout(resizeCanvas, 100);
        });

        // ì´ˆê¸° ì„¤ì •
        loadGameData();
        resizeCanvas();

        // ì´ˆê¸° ë Œë”ë§
        gameLoop();
    </script>
</body>
</html>